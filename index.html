<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Workout App</title>

  <style>
    :root{
      /* ÂÖ®‰Ωì„ÇíÂ∞è„Åï„ÇÅÔºà„Çπ„ÇØ„É≠„Éº„É´ÁÑ°„ÅóÂØÑ„ÅõÔºâ */
      --scale: 0.94;

      --card-radius: 26px;
      --soft-radius: 18px;

      --padX: calc(18px * var(--scale));
      --padY: calc(14px * var(--scale));

      --text: #1f2430;
      --muted: rgba(31,36,48,.55);

      --glass: rgba(255,255,255,.50);
      --glass2: rgba(255,255,255,.38);

      --shadow: 0 18px 40px rgba(0,0,0,.12);
      --stroke: rgba(255,255,255,.55);

      --banner-h: calc(112px * var(--scale)); /* „Éê„Éä„ÉºÈ´ò„Åï */
      --btn-h: calc(54px * var(--scale));
    }

    body{
      margin: 0;
      font-family: system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
      color: var(--text);

      min-height: 100svh;
      background: url("assets/background.png") center top / cover no-repeat fixed;

      padding:
        env(safe-area-inset-top)
        env(safe-area-inset-right)
        env(safe-area-inset-bottom)
        env(safe-area-inset-left);
    }

    .app{
      max-width: 430px;
      margin: 0 auto;
      padding: calc(14px * var(--scale)) var(--padX) calc(16px * var(--scale));
    }

    .header{
      text-align: center;
      padding: calc(10px * var(--scale)) 0 calc(10px * var(--scale));
    }

    .title{
      margin: 0 0 calc(12px * var(--scale));
      font-size: clamp(28px, 5.3vw, 36px);
      font-weight: 900;
      letter-spacing: .02em;
      text-shadow: 0 2px 14px rgba(255,255,255,.8);
    }

    .mood-tabs{
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: calc(10px * var(--scale));
    }

    .tab{
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.62);
      border-radius: 18px;
      padding: calc(10px * var(--scale)) calc(8px * var(--scale));
      box-shadow: 0 10px 22px rgba(0,0,0,.07);
      font-weight: 800;
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      transition: transform .08s ease;
    }
    .tab:active{ transform: scale(.98); }
    .tab.is-active{
      background: rgba(255,255,255,.78);
      box-shadow: 0 14px 26px rgba(0,0,0,.10);
    }

    .card{
      margin-top: calc(10px * var(--scale));
      background: var(--glass);
      border: 1px solid var(--stroke);
      border-radius: var(--card-radius);
      box-shadow: var(--shadow);
      padding: calc(14px * var(--scale));
      backdrop-filter: blur(12px);
    }

    .badge{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: calc(8px * var(--scale)) calc(12px * var(--scale));
      border-radius: 999px;
      background: rgba(255,255,255,.70);
      border: 1px solid rgba(255,255,255,.75);
      font-weight: 900;
      box-shadow: 0 10px 20px rgba(0,0,0,.06);
    }

    .card-head{
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      gap: 12px;
      margin-top: calc(10px * var(--scale));
    }

    .workout-title{
      margin: calc(6px * var(--scale)) 0 0;
      font-size: clamp(30px, 7vw, 44px);
      line-height: 1.02;
      font-weight: 950;
      letter-spacing: .01em;
    }

    /* Á∂ôÁ∂öË°®Á§∫ÔºàÁÇé„Ç¢„Éã„É°Ôºâ */
    .streak{
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(255,255,255,.72);
      box-shadow: 0 10px 22px rgba(0,0,0,.06);
      font-weight: 900;
      white-space: nowrap;
    }
    .flame{
      display:inline-block;
      transform-origin: 50% 85%;
      animation: flame 1.1s ease-in-out infinite;
    }
    @keyframes flame{
      0%   { transform: rotate(-8deg) scale(1); filter: drop-shadow(0 0 0 rgba(255,140,0,0)); }
      50%  { transform: rotate(9deg) scale(1.06); filter: drop-shadow(0 0 8px rgba(255,140,0,.35)); }
      100% { transform: rotate(-8deg) scale(1); }
    }

    /* „Éê„Éä„ÉºÔºöÁ∏¶Ê®™„Éî„ÉÉ„Çø„É™Ôºà‰ΩôÁôΩ„Çº„É≠Ôºâ */
    .banner{
      margin-top: calc(12px * var(--scale));
      height: var(--banner-h);
      border-radius: 22px;
      overflow: hidden;
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(255,255,255,.7);
    }
    .banner img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block; /* ‰∏ã„ÅÆË¨é‰ΩôÁôΩÂØæÁ≠ñ */
    }

    .stats{
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: calc(12px * var(--scale));
      margin-top: calc(12px * var(--scale));
    }

    .stat{
      background: rgba(255,255,255,.58);
      border: 1px solid rgba(255,255,255,.72);
      border-radius: 20px;
      padding: calc(12px * var(--scale));
      box-shadow: 0 12px 26px rgba(0,0,0,.06);
      min-height: calc(104px * var(--scale));
    }

    .stat-top{
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }

    .stat-title{
      font-weight: 900;
      color: rgba(31,36,48,.75);
      line-height: 1.05;
    }
    .stat-title .line1{ font-size: calc(15px * var(--scale)); }
    .stat-title .line2{
      font-size: calc(13px * var(--scale));
      opacity: .75;
      margin-top: 3px;
    }

    .icon{
      font-size: 18px;
      opacity: .85;
      margin-top: 2px;
    }

    .stat-value{
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      margin-top: calc(12px * var(--scale));
    }

    .stat-value input{
      width: 100%;
      max-width: 120px;
      font-size: calc(36px * var(--scale));
      font-weight: 950;
      border: none;
      outline: none;
      background: transparent;
      color: var(--text);
    }
    .stat-value input::placeholder{ color: rgba(0,0,0,0); }

    .unit{
      font-size: calc(16px * var(--scale));
      font-weight: 900;
      color: var(--muted);
      margin-left: 8px;
    }

    .actions{
      display: grid;
      gap: calc(10px * var(--scale));
      margin-top: calc(12px * var(--scale));
    }

    .btn{
      height: var(--btn-h);
      border-radius: 18px;
      border: none;
      font-weight: 950;
      font-size: calc(18px * var(--scale));
      cursor: pointer;
      box-shadow: 0 16px 30px rgba(0,0,0,.10);
    }
    .btn:active{ transform: scale(.99); }

    .btn.primary{
      background: linear-gradient(90deg, #ffb04a, #ff7d1f);
      color: white;
    }
    .btn.secondary{
      background: linear-gradient(90deg, #5aa7ff, #2f6dff);
      color: white;
    }

    .meta{
      text-align: center;
      margin-top: calc(10px * var(--scale));
      color: rgba(31,36,48,.55);
      font-weight: 800;
      font-size: calc(13px * var(--scale));
    }

    .bottom-nav{
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: calc(12px * var(--scale));
      margin-top: calc(12px * var(--scale));
    }

    .nav-item{
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.70);
      background: rgba(255,255,255,.55);
      padding: calc(12px * var(--scale)) calc(10px * var(--scale));
      font-weight: 950;
      box-shadow: 0 14px 26px rgba(0,0,0,.08);
      cursor: pointer;
    }
    .nav-item.is-active{ background: rgba(255,255,255,.72); }

    .history{
      margin-top: calc(12px * var(--scale));
      background: rgba(255,255,255,.62);
      border: 1px solid rgba(255,255,255,.75);
      border-radius: 22px;
      box-shadow: 0 18px 40px rgba(0,0,0,.10);
      padding: calc(14px * var(--scale));
    }
    .hidden{ display: none; }

    .history-head{
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    .history-head h3{
      margin: 0;
      font-size: 18px;
      font-weight: 950;
    }

    .chip{
      border: 1px solid rgba(0,0,0,.08);
      background: rgba(255,255,255,.65);
      border-radius: 999px;
      padding: 8px 12px;
      font-weight: 900;
      cursor: pointer;
    }

    .history-list{
      display: grid;
      gap: 10px;
    }
    .item{
      border-radius: 16px;
      background: rgba(255,255,255,.60);
      border: 1px solid rgba(255,255,255,.75);
      padding: 12px;
      box-shadow: 0 10px 22px rgba(0,0,0,.06);
    }
    .item .top{
      display: flex;
      justify-content: space-between;
      gap: 10px;
      font-weight: 950;
    }
    .item .sub{
      margin-top: 6px;
      color: rgba(31,36,48,.6);
      font-weight: 800;
      font-size: 13px;
    }
  </style>
</head>

<body>
  <main class="app">
    <header class="header">
      <h1 class="title">‰ªäÊó•„ÅÆ‰ΩìË™ø„ÅØÔºü</h1>

      <nav class="mood-tabs" aria-label="‰ΩìË™ø">
        <button class="tab is-active" data-mood="genki">
          <span class="emoji">‚òÄÔ∏è</span><span class="label">ÂÖÉÊ∞ó</span>
        </button>
        <button class="tab" data-mood="futsu">
          <span class="emoji">üíô</span><span class="label">„Åµ„Å§„ÅÜ</span>
        </button>
        <button class="tab" data-mood="shindoi">
          <span class="emoji">üôÇ</span><span class="label">„Åó„Çì„Å©„ÅÑ</span>
        </button>
        <button class="tab" data-mood="kyukei">
          <span class="emoji">üêæ</span><span class="label">‰ºëÊÅØ</span>
        </button>
      </nav>
    </header>

    <section class="card">
      <div class="badge" id="badge">
        <span class="emoji">‚òÄÔ∏è</span><span>ÂÖÉÊ∞ó</span>
      </div>

      <div class="card-head">
        <h2 class="workout-title" id="workoutTitle">Fit Boxing</h2>

        <div class="streak" title="Á∂ôÁ∂öÊó•Êï∞">
          <span class="flame" aria-hidden="true">üî•</span>
          <span class="streak-text"><span id="streakDays">0</span>Êó•Á∂ôÁ∂ö</span>
        </div>
      </div>

      <div class="banner">
        <img id="bannerImg" src="assets/fitboxing.png" alt="workout banner" />
      </div>

      <div class="stats">
        <div class="stat">
          <div class="stat-top">
            <span class="icon">üëü</span>
            <div class="stat-title">
              <div class="line1">‰ªäÊó•„ÅÆÊ≠©Êï∞</div>
              <div class="line2">ÔºàÁ©∫Ê¨ÑNGÔºâ</div>
            </div>
          </div>
          <div class="stat-value">
            <input id="stepsInput" inputmode="numeric" pattern="[0-9]*" placeholder=" " />
            <span class="unit">Ê≠©</span>
          </div>
        </div>

        <div class="stat">
          <div class="stat-top">
            <span class="icon">üïí</span>
            <div class="stat-title">
              <div class="line1">ÈÅãÂãï</div>
              <div class="line2">ÔºàÁ©∫Ê¨ÑNGÔºâ</div>
            </div>
          </div>
          <div class="stat-value">
            <input id="minsInput" inputmode="numeric" pattern="[0-9]*" placeholder=" " />
            <span class="unit">ÂàÜ</span>
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="btn primary" id="doneBtn">‚úÖ „ÇÑ„Å£„ÅüÔºÅ</button>
        <button class="btn secondary" id="moreBtn">Ôºã „ÇÇ„ÅÜ1„Å§„ÇÑ„Çã</button>
      </div>

      <div class="meta" id="metaText">Ë®òÈå≤Ôºö‚Äî</div>
    </section>

    <footer class="bottom-nav">
      <button class="nav-item is-active" data-view="home">üè† „Éõ„Éº„É†</button>
      <button class="nav-item" data-view="history">üïò Â±•Ê≠¥</button>
    </footer>

    <section class="history hidden" id="history">
      <div class="history-head">
        <h3>Â±•Ê≠¥</h3>
        <button class="chip" id="clearBtn">Â±•Ê≠¥„ÇíÂâäÈô§</button>
      </div>
      <div class="history-list" id="historyList"></div>
    </section>
  </main>

  <script>
    const MOODS = {
      genki:   { label: "ÂÖÉÊ∞ó", emoji: "‚òÄÔ∏è", banner: "assets/fitboxing.png", title: "Fit Boxing" },
      futsu:   { label: "„Åµ„Å§„ÅÜ", emoji: "üíô", banner: "assets/ringfit.png",  title: "Ring Fit" },
      shindoi: { label: "„Åó„Çì„Å©„ÅÑ", emoji: "üôÇ", banner: "assets/yoga.png",    title: "„É®„Ç¨ (Yoga)" },
      kyukei:  { label: "‰ºëÊÅØ", emoji: "üêæ", banner: "assets/rest.png",       title: "Rest" },
    };

    const LS_KEY = "workout_app_records_v1";
    const LS_STREAK = "workout_app_streak_v1";

    const tabs = document.querySelectorAll(".tab");
    const badge = document.getElementById("badge");
    const workoutTitle = document.getElementById("workoutTitle");
    const bannerImg = document.getElementById("bannerImg");

    const stepsInput = document.getElementById("stepsInput");
    const minsInput = document.getElementById("minsInput");

    const doneBtn = document.getElementById("doneBtn");
    const moreBtn = document.getElementById("moreBtn");

    const metaText = document.getElementById("metaText");

    const navItems = document.querySelectorAll(".nav-item");
    const historyPanel = document.getElementById("history");
    const historyList = document.getElementById("historyList");
    const clearBtn = document.getElementById("clearBtn");

    const streakDaysEl = document.getElementById("streakDays");

    let currentMood = "genki";

    function todayKey() {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return \`\${y}-\${m}-\${day}\`;
    }

    function yesterdayKey(key) {
      const [y, m, d] = key.split("-").map(Number);
      const dt = new Date(y, m - 1, d);
      dt.setDate(dt.getDate() - 1);
      const yy = dt.getFullYear();
      const mm = String(dt.getMonth() + 1).padStart(2, "0");
      const dd = String(dt.getDate()).padStart(2, "0");
      return \`\${yy}-\${mm}-\${dd}\`;
    }

    function loadRecords() {
      try { return JSON.parse(localStorage.getItem(LS_KEY) || "[]"); }
      catch { return []; }
    }
    function saveRecords(records) {
      localStorage.setItem(LS_KEY, JSON.stringify(records));
    }

    function loadStreak() {
      try { return JSON.parse(localStorage.getItem(LS_STREAK) || '{"last":"","streak":0}'); }
      catch { return { last: "", streak: 0 }; }
    }
    function saveStreak(data) {
      localStorage.setItem(LS_STREAK, JSON.stringify(data));
    }

    function updateStreakUI() {
      const s = loadStreak();
      streakDaysEl.textContent = String(s.streak || 0);
    }

    function bumpStreakOnSave() {
      const key = todayKey();
      const s = loadStreak();

      if (s.last === key) return; // ÂêåÊó•‰∫åÈáçÂä†ÁÆó„Åó„Å™„ÅÑ

      if (s.last && yesterdayKey(key) === s.last) {
        s.streak = (s.streak || 0) + 1;
      } else {
        s.streak = 1;
      }

      s.last = key;
      saveStreak(s);
    }

    function setMood(mood) {
      currentMood = mood;
      const conf = MOODS[mood];

      tabs.forEach(t => t.classList.toggle("is-active", t.dataset.mood === mood));
      badge.innerHTML = \`<span class="emoji">\${conf.emoji}</span><span>\${conf.label}</span>\`;
      workoutTitle.textContent = conf.title;
      bannerImg.src = conf.banner;

      metaText.textContent = \`Ë®òÈå≤Ôºö\${todayKey()}„ÄÅ\${conf.label}\`;
    }

    function renderHistory() {
      const records = loadRecords().slice().reverse();
      historyList.innerHTML = "";

      if (records.length === 0) {
        historyList.innerHTML =
          \`<div class="item"><div class="top"><span>„Åæ„Å†Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</span></div><div class="sub">„Äå„ÇÑ„Å£„ÅüÔºÅ„Äç„Åß‰øùÂ≠ò„Åï„Çå„Åæ„Åô</div></div>\`;
        return;
      }

      for (const r of records) {
        const mood = MOODS[r.mood]?.label ?? r.mood;
        const title = r.title ?? "";
        historyList.insertAdjacentHTML("beforeend", \`
          <div class="item">
            <div class="top">
              <span>\${r.date} / \${mood}</span>
              <span>\${title}</span>
            </div>
            <div class="sub">Ê≠©Êï∞: \${r.steps}Ê≠© / ÈÅãÂãï: \${r.mins}ÂàÜ</div>
          </div>
        \`);
      }
    }

    function getNumberValue(el) {
      const v = (el.value || "").trim();
      if (!v) return null;
      const n = Number(v);
      if (!Number.isFinite(n)) return null;
      return Math.max(0, Math.floor(n));
    }

    function onDone() {
      const steps = getNumberValue(stepsInput);
      const mins = getNumberValue(minsInput);

      if (steps === null || mins === null) {
        alert("„Äå‰ªäÊó•„ÅÆÊ≠©Êï∞„Äç„Å®„ÄåÈÅãÂãï„Äç„ÅØÁ©∫Ê¨ÑNG„Åß„Åô„ÄÇÊï∞Â≠ó„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");
        return;
      }

      const record = {
        date: todayKey(),
        mood: currentMood,
        title: MOODS[currentMood].title,
        steps,
        mins,
      };

      const records = loadRecords();
      records.push(record);
      saveRecords(records);

      bumpStreakOnSave();
      updateStreakUI();
      renderHistory();

      stepsInput.value = "";
      minsInput.value = "";
    }

    function setView(view) {
      navItems.forEach(n => n.classList.toggle("is-active", n.dataset.view === view));
      historyPanel.classList.toggle("hidden", view !== "history");
    }

    // events
    tabs.forEach(t => t.addEventListener("click", () => setMood(t.dataset.mood)));
    doneBtn.addEventListener("click", onDone);
    moreBtn.addEventListener("click", () => stepsInput.focus());

    navItems.forEach(n => n.addEventListener("click", () => setView(n.dataset.view)));

    clearBtn.addEventListener("click", () => {
      if (!confirm("Â±•Ê≠¥„Çí„Åô„Åπ„Å¶ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü")) return;
      localStorage.removeItem(LS_KEY);
      renderHistory();
    });

    // init
    setMood("genki");
    updateStreakUI();
    renderHistory();
    setView("home");
  </script>
</body>
</html>