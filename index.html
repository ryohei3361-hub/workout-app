<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#b9d8ff" />
  <title>Workout App</title>

  <style>
    :root{
      --card: rgba(255,255,255,.60);
      --stroke: rgba(255,255,255,.55);
      --shadow: 0 18px 40px rgba(0,0,0,.12);
      --shadow2: 0 10px 22px rgba(0,0,0,.10);
      --r1: 28px;
      --txt: #1f2630;
      --muted:#5a6777;

      --btnOrange1:#ffb04a;
      --btnOrange2:#ff7e2f;
      --btnBlue1:#4c92ff;
      --btnBlue2:#2c63ff;

      --safeTop: env(safe-area-inset-top);
      --safeBottom: env(safe-area-inset-bottom);
      --safeLeft: env(safe-area-inset-left);
      --safeRight: env(safe-area-inset-right);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP", "Segoe UI", Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color: var(--txt);
      overflow:hidden; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç„¡ã— */
      background:
        radial-gradient(1200px 700px at 50% -120px, rgba(255,255,255,.55), rgba(255,255,255,0) 58%),
        url("background.png");
      background-size: cover, cover;
      background-position: center top, center top;
      background-repeat: no-repeat, no-repeat;
    }

    .app{
      height:100dvh;
      padding:
        calc(14px + var(--safeTop))
        calc(14px + var(--safeRight))
        calc(14px + var(--safeBottom))
        calc(14px + var(--safeLeft));
      display:flex;
      justify-content:center;
      align-items:flex-start;
    }

    /* ç«¯æœ«é«˜ã•ã«å¿œã˜ã¦è‡ªå‹•ã§å°ã•ã‚ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å‡ºã•ãªã„ï¼‰ */
    .scaleWrap{
      width:min(420px, 100%);
      transform-origin: top center;
    }
    @media (max-height: 820px){ .scaleWrap{ transform: scale(.96); } }
    @media (max-height: 760px){ .scaleWrap{ transform: scale(.92); } }
    @media (max-height: 700px){ .scaleWrap{ transform: scale(.88); } }

    h1{
      margin: 8px 0 14px;
      text-align:center;
      font-weight: 900;
      letter-spacing: .02em;
      font-size: clamp(28px, 6.6vw, 44px);
      text-shadow: 0 2px 0 rgba(255,255,255,.35);
    }

    .tabs{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin: 0 0 14px;
    }
    .tab{
      appearance:none;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.50);
      border-radius: 18px;
      padding: 10px 8px;
      font-weight: 800;
      color: #2a3441;
      box-shadow: 0 10px 22px rgba(0,0,0,.08);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      font-size: 14px;
      line-height:1;
      cursor:pointer;
      user-select:none;
    }
    .tab.active{
      background: rgba(255,255,255,.78);
      border-color: rgba(255,255,255,.8);
      box-shadow: 0 14px 28px rgba(0,0,0,.10);
      transform: translateY(-1px);
    }

    .card{
      border-radius: var(--r1);
      background: var(--card);
      border: 1px solid rgba(255,255,255,.55);
      box-shadow: var(--shadow);
      padding: 16px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .pillRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 8px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.62);
      background: rgba(255,255,255,.60);
      font-weight: 900;
      box-shadow: 0 10px 18px rgba(0,0,0,.08);
      line-height:1;
      white-space:nowrap;
    }

    /* ç‚ã‚¢ãƒ‹ãƒ¡ï¼ˆç¶™ç¶šï¼‰ */
    .flame{
      width: 18px; height: 18px;
      display:inline-grid;
      place-items:center;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,.18));
      animation: flameWiggle 1.2s ease-in-out infinite;
      transform-origin: 50% 75%;
    }
    @keyframes flameWiggle{
      0%{ transform: translateY(0) rotate(-6deg) scale(1); }
      35%{ transform: translateY(-1px) rotate(6deg) scale(1.05); }
      70%{ transform: translateY(0) rotate(-4deg) scale(1); }
      100%{ transform: translateY(0) rotate(-6deg) scale(1); }
    }

    .titleRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
      margin: 6px 0 10px;
    }
    .activityTitle{
      font-size: 44px;
      font-weight: 1000;
      letter-spacing: .01em;
      margin:0;
      line-height: .95;
    }

    /* ãƒãƒŠãƒ¼ï¼šæ ã«ç¸¦æ¨ªãƒ”ãƒƒã‚¿ãƒª */
    .bannerWrap{
      margin-top: 10px;
      border-radius: 20px;
      background: rgba(255,255,255,.42);
      border: 1px solid rgba(255,255,255,.52);
      box-shadow: var(--shadow2);
      padding: 10px;
    }
    .banner{
      width:100%;
      aspect-ratio: 2.75 / 1;
      border-radius: 16px;
      overflow:hidden;
      background: rgba(255,255,255,.35);
      border: 1px solid rgba(255,255,255,.50);
    }
    .banner img{
      width:100%;
      height:100%;
      display:block;
      object-fit: cover;
      object-position: center;
    }

    .stats{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }
    .stat{
      border-radius: 18px;
      background: rgba(255,255,255,.60);
      border: 1px solid rgba(255,255,255,.62);
      box-shadow: var(--shadow2);
      padding: 12px 12px 10px;
      min-height: 120px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
    }
    .statHead{
      display:flex;
      gap: 10px;
      align-items:flex-start;
      color: var(--muted);
      font-weight: 900;
      letter-spacing:.01em;
    }
    .statIcon{
      width: 28px; height: 28px;
      border-radius: 50%;
      background: rgba(0,0,0,.08);
      display:grid;
      place-items:center;
      flex:0 0 auto;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.55);
    }
    .statLabel{
      font-size: 16px;
      line-height: 1.05;
    }
    .statLabel .l1{ display:block; }
    .statLabel .l2{ display:block; }
    .statValueRow{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      margin-top: 6px;
    }
    .statValue{
      font-size: 54px;
      font-weight: 1000;
      letter-spacing: .01em;
      line-height:1;
    }
    .statUnit{
      font-size: 20px;
      font-weight: 900;
      color: var(--muted);
      padding-bottom: 4px;
    }

    .actions{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-top: 12px;
    }
    .btn{
      appearance:none;
      border: none;
      border-radius: 22px;
      padding: 16px 14px;
      font-weight: 1000;
      font-size: 22px;
      color: white;
      cursor:pointer;
      box-shadow: 0 16px 32px rgba(0,0,0,.16);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      user-select:none;
    }
    .btn.orange{ background: linear-gradient(90deg, var(--btnOrange1), var(--btnOrange2)); }
    .btn.blue{ background: linear-gradient(90deg, #9aa6b5, #6f7d90); }

    .recordLine{
      margin-top: 10px;
      text-align:center;
      font-weight: 900;
      color: rgba(31,38,48,.70);
    }

    .nav{
      margin-top: 12px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    .navBtn{
      appearance:none;
      border: 1px solid rgba(255,255,255,.55);
      background: rgba(255,255,255,.40);
      border-radius: 18px;
      padding: 12px 10px;
      font-weight: 1000;
      color: #2a3441;
      box-shadow: var(--shadow2);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      cursor:pointer;
    }
    .navBtn.active{
      background: rgba(255,255,255,.65);
    }

    .view{ display:none; }
    .view.active{ display:block; }

    .historyList{
      margin-top: 12px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      max-height: 42dvh;
      overflow:auto;
      padding-right: 2px;
    }
    .historyItem{
      border-radius: 18px;
      background: rgba(255,255,255,.62);
      border: 1px solid rgba(255,255,255,.65);
      box-shadow: var(--shadow2);
      padding: 12px;
      display:flex;
      justify-content:space-between;
      gap: 10px;
      align-items:center;
      font-weight: 900;
    }
    .historyItem small{
      font-weight: 800;
      color: rgba(31,38,48,.65);
      display:block;
      margin-top: 2px;
    }

    .dangerRow{
      margin-top: 10px;
      display:flex;
      justify-content:center;
    }
    .danger{
      appearance:none;
      background: rgba(255,255,255,.35);
      border: 1px solid rgba(255,255,255,.55);
      padding: 10px 14px;
      border-radius: 999px;
      font-weight: 1000;
      color: rgba(180,40,40,.9);
      cursor:pointer;
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="scaleWrap">
      <h1>ä»Šæ—¥ã®ä½“èª¿ã¯ï¼Ÿ</h1>

      <div class="tabs" id="tabs">
        <button class="tab" type="button" data-mood="genki">â˜€ï¸ å…ƒæ°—</button>
        <button class="tab" type="button" data-mood="futsu">ğŸ’™ ãµã¤ã†</button>
        <button class="tab" type="button" data-mood="shindoi">ğŸ™‚ ã—ã‚“ã©ã„</button>
        <button class="tab" type="button" data-mood="rest">ğŸ¾ ä¼‘æ¯</button>
      </div>

      <!-- HOME -->
      <div class="view active" id="viewHome">
        <div class="card">
          <div class="pillRow">
            <div class="pill" id="moodLabel">â˜€ï¸ å…ƒæ°—</div>
            <div class="pill"><span class="flame">ğŸ”¥</span><span id="streakText">0æ—¥ç¶™ç¶š</span></div>
          </div>

          <div class="titleRow">
            <h2 class="activityTitle" id="activityTitle">Fit Boxing</h2>
          </div>

          <div class="bannerWrap">
            <div class="banner">
              <img id="bannerImg" alt="banner" src="fitboxing.png" />
            </div>
          </div>

          <div class="stats">
            <div class="stat">
              <div class="statHead">
                <div class="statIcon">ğŸ‘Ÿ</div>
                <div class="statLabel">
                  <span class="l1">ä»Šæ—¥ã®æ­©æ•°</span>
                  <span class="l2">ï¼ˆç©ºæ¬„NGï¼‰</span>
                </div>
              </div>
              <div class="statValueRow">
                <div class="statValue" id="stepsValue">0</div>
                <div class="statUnit">æ­©</div>
              </div>
            </div>

            <div class="stat">
              <div class="statHead">
                <div class="statIcon">ğŸ•’</div>
                <div class="statLabel">
                  <span class="l1">é‹å‹•</span>
                  <span class="l2">ï¼ˆç©ºæ¬„NGï¼‰</span>
                </div>
              </div>
              <div class="statValueRow">
                <div class="statValue" id="minsValue">0</div>
                <div class="statUnit">åˆ†</div>
              </div>
            </div>
          </div>

          <div class="actions">
            <button class="btn orange" id="doneBtn" type="button">âœ… ã‚„ã£ãŸï¼</button>
            <button class="btn blue" id="moreBtn" type="button">ğŸ² å…ƒæ°—ã®ã¨ãã ã‘å†æŠ½é¸</button>
          </div>

          <div class="recordLine" id="recordLine">è¨˜éŒ²ï¼šâ€”</div>
        </div>

        <div class="nav">
          <button class="navBtn active" id="navHome" type="button">ğŸ  ãƒ›ãƒ¼ãƒ </button>
          <button class="navBtn" id="navHistory" type="button">ğŸ•˜ å±¥æ­´</button>
        </div>
      </div>

      <!-- HISTORY -->
      <div class="view" id="viewHistory">
        <div class="card">
          <div class="pillRow">
            <div class="pill">ğŸ•˜ å±¥æ­´</div>
            <div class="pill" id="historyCount">0ä»¶</div>
          </div>

          <div class="historyList" id="historyList"></div>

          <div class="dangerRow">
            <button class="danger" id="clearBtn" type="button">å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤</button>
          </div>
        </div>

        <div class="nav">
          <button class="navBtn" id="navHome2" type="button">ğŸ  ãƒ›ãƒ¼ãƒ </button>
          <button class="navBtn active" id="navHistory2" type="button">ğŸ•˜ å±¥æ­´</button>
        </div>
      </div>
    </div>
  </div>

<script>
  /***************
   * ç”»åƒåï¼ˆã‚ãªãŸæŒ‡å®šã®ç¢ºå®šç‰ˆï¼‰
   ***************/
  const IMG = {
    background: "background.png",
    genkiRandom: [
      { key:"fitboxing", title:"Fit Boxing", img:"fitboxing.png" },
      { key:"ringfit", title:"Ring Fit", img:"ringfit.png" },
      { key:"hopstepdance", title:"HOP!STEP!DANCE!", img:"hopstepdance.png" },
    ],
    futsu:   { key:"fitboxing", title:"Fit Boxing", img:"fitboxing.png" },
    shindoi: { key:"yoga", title:"Yoga", img:"yoga.png" },
    rest:    { key:"rest", title:"Rest", img:"rest.png" },
  };

  /***************
   * storage
   ***************/
  const LS_KEY = "workout_app_v3";
  const $ = (q)=>document.querySelector(q);

  function todayKey(){
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const da = String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${da}`;
  }

  function loadState(){
    try { return JSON.parse(localStorage.getItem(LS_KEY)) || {}; }
    catch { return {}; }
  }
  function saveState(s){ localStorage.setItem(LS_KEY, JSON.stringify(s)); }

  let state = loadState();
  state.mood = state.mood || "genki";
  state.choice = state.choice || null; // ãã®æ—¥ã®è¡¨ç¤ºãƒ¡ãƒ‹ãƒ¥ãƒ¼
  state.history = Array.isArray(state.history) ? state.history : [];
  state.streak = Number.isFinite(state.streak) ? state.streak : 0;
  state.lastDoneDate = state.lastDoneDate || "";

  /***************
   * refs
   ***************/
  const moodLabel = $("#moodLabel");
  const streakText = $("#streakText");
  const activityTitle = $("#activityTitle");
  const bannerImg = $("#bannerImg");
  const stepsValue = $("#stepsValue");
  const minsValue = $("#minsValue");
  const recordLine = $("#recordLine");

  const viewHome = $("#viewHome");
  const viewHistory = $("#viewHistory");
  const navHome = $("#navHome");
  const navHistory = $("#navHistory");
  const navHome2 = $("#navHome2");
  const navHistory2 = $("#navHistory2");

  const historyList = $("#historyList");
  const historyCount = $("#historyCount");
  const clearBtn = $("#clearBtn");

  const doneBtn = $("#doneBtn");
  const moreBtn = $("#moreBtn");

  /***************
   * view
   ***************/
  function setView(v){
    const isHome = v === "home";
    viewHome.classList.toggle("active", isHome);
    viewHistory.classList.toggle("active", !isHome);

    navHome.classList.toggle("active", isHome);
    navHistory.classList.toggle("active", !isHome);
    navHome2.classList.toggle("active", isHome);
    navHistory2.classList.toggle("active", !isHome);

    if (!isHome) renderHistory();
  }

  function setMood(mood){
    state.mood = mood;
    saveState(state);

    document.querySelectorAll("[data-mood]").forEach(btn=>{
      btn.classList.toggle("active", btn.dataset.mood === mood);
    });

    const map = { genki:"â˜€ï¸ å…ƒæ°—", futsu:"ğŸ’™ ãµã¤ã†", shindoi:"ğŸ™‚ ã—ã‚“ã©ã„", rest:"ğŸ¾ ä¼‘æ¯" };
    moodLabel.textContent = map[mood] || "ğŸ’™ ãµã¤ã†";

    // ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºã‚’æ›´æ–°
    ensureChoice();
    renderChoice();
    renderTodayPreview();
  }

  function randomPick(arr){
    return arr[Math.floor(Math.random() * arr.length)];
  }

  function ensureChoice(){
    // â€œåŒã˜æ—¥ã«è¦‹ã›ã‚‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼â€ã‚’ä¿æŒã—ãŸã„ã®ã§ã€ä»Šæ—¥ã®æ—¥ä»˜ã¨ã‚»ãƒƒãƒˆã§ä¿å­˜
    const key = todayKey();

    if (state.choice && state.choice.date === key) return;

    // æ—¥ä»˜ãŒå¤‰ã‚ã£ãŸã‚‰æ–°è¦ã«ä½œã‚‹
    let picked;
    if (state.mood === "genki") picked = randomPick(IMG.genkiRandom);
    else if (state.mood === "futsu") picked = IMG.futsu;
    else if (state.mood === "shindoi") picked = IMG.shindoi;
    else picked = IMG.rest;

    state.choice = { date: key, ...picked };
    saveState(state);
  }

  function renderChoice(){
    if (!state.choice) return;
    activityTitle.textContent = state.choice.title;
    bannerImg.src = state.choice.img;
  }

  function updateStreakUI(){
    streakText.textContent = `${state.streak}æ—¥ç¶™ç¶š`;
  }

  function renderTodayPreview(){
    const key = todayKey();
    const today = state.history.find(h => h.date === key);
    if (!today){
      stepsValue.textContent = "0";
      minsValue.textContent = "0";
      recordLine.textContent = "è¨˜éŒ²ï¼šâ€”";
      return;
    }
    stepsValue.textContent = String(today.steps);
    minsValue.textContent = String(today.mins);
    recordLine.textContent = `è¨˜éŒ²ï¼š${today.date}`;
  }

  function renderHistory(){
    historyList.innerHTML = "";
    const items = [...state.history].sort((a,b)=> (a.date < b.date ? 1 : -1));
    historyCount.textContent = `${items.length}ä»¶`;

    if (items.length === 0){
      const div = document.createElement("div");
      div.className = "historyItem";
      div.textContent = "ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“";
      historyList.appendChild(div);
      return;
    }

    items.forEach(h=>{
      const row = document.createElement("div");
      row.className = "historyItem";

      const left = document.createElement("div");
      left.innerHTML = `${h.title}<small>${h.date} / ${h.moodLabel}</small>`;

      const right = document.createElement("div");
      right.textContent = `${h.steps}æ­© / ${h.mins}åˆ†`;

      row.appendChild(left);
      row.appendChild(right);
      historyList.appendChild(row);
    });
  }

  /***************
   * input helpers
   ***************/
  function promptNumber(label){
    const s = prompt(label);
    if (s === null) return null; // ã‚­ãƒ£ãƒ³ã‚»ãƒ«
    const t = String(s).trim();
    // ç©ºæ¬„NGï¼ˆ0ã§ã‚‚å…¥åŠ›å¿…é ˆï¼‰
    if (t === "") return NaN;
    const n = Number(t);
    if (!Number.isFinite(n) || n < 0) return NaN;
    return Math.floor(n);
  }

  function calcStreakOnDone(dateStr){
    // åŒæ—¥2å›æŠ¼ã—ã¦ã‚‚ç¶™ç¶šã¯å¢—ã‚„ã•ãªã„ï¼ˆå±¥æ­´ã¯ä¸Šæ›¸ãï¼‰
    if (state.lastDoneDate === dateStr) return;

    if (!state.lastDoneDate){
      state.streak = 1;
      state.lastDoneDate = dateStr;
      return;
    }

    const last = new Date(state.lastDoneDate + "T00:00:00");
    const today = new Date(dateStr + "T00:00:00");
    const diffDays = Math.round((today - last) / (1000*60*60*24));

    if (diffDays === 1) state.streak += 1;
    else if (diffDays > 1) state.streak = 1;

    state.lastDoneDate = dateStr;
  }

  /***************
   * actions
   ***************/
  function saveDone(){
    ensureChoice();

    const steps = promptNumber("ä»Šæ—¥ã®æ­©æ•°ï¼ˆç©ºæ¬„NGï¼‰ã‚’æ•°å­—ã§å…¥åŠ›ã—ã¦ã­ï¼ˆ0ã§ã‚‚OKï¼‰");
    if (steps === null) return;
    if (Number.isNaN(steps)) { alert("ç©ºæ¬„NGã§ã™ã€‚0ã§ã‚‚ã„ã„ã®ã§æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }

    const mins = promptNumber("é‹å‹•ï¼ˆç©ºæ¬„NGï¼‰ã‚’åˆ†ã§å…¥åŠ›ã—ã¦ã­ï¼ˆ0ã§ã‚‚OKï¼‰");
    if (mins === null) return;
    if (Number.isNaN(mins)) { alert("ç©ºæ¬„NGã§ã™ã€‚0ã§ã‚‚ã„ã„ã®ã§æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }

    const dateStr = todayKey();
    const moodMap = { genki:"â˜€ï¸ å…ƒæ°—", futsu:"ğŸ’™ ãµã¤ã†", shindoi:"ğŸ™‚ ã—ã‚“ã©ã„", rest:"ğŸ¾ ä¼‘æ¯" };

    const rec = {
      date: dateStr,
      mood: state.mood,
      moodLabel: moodMap[state.mood] || "",
      title: state.choice.title,
      activityKey: state.choice.key,
      img: state.choice.img,
      steps, mins
    };

    // 1æ—¥1ä»¶ã§ä¸Šæ›¸ãï¼ˆâ€œãã®æ—¥1å›ã§ã‚‚æŠ¼ã™â€ãƒ«ãƒ¼ãƒ«ã«åˆã†ï¼‰
    const idx = state.history.findIndex(h=>h.date===dateStr);
    if (idx >= 0) state.history[idx] = rec;
    else state.history.push(rec);

    calcStreakOnDone(dateStr);
    saveState(state);

    updateStreakUI();
    renderTodayPreview();
    alert("ã‚„ã£ãŸï¼è¨˜éŒ²ã—ã¾ã—ãŸ âœ…");
  }

  function rerollGenki(){
    if (state.mood !== "genki"){
      alert("å†æŠ½é¸ã¯ã€Œå…ƒæ°—ã€ã®ã¨ãã ã‘ã§ã™ï¼");
      return;
    }
    // ä»Šæ—¥ã®choiceã‚’ä¸Šæ›¸ãã—ã¦å†æŠ½é¸
    const key = todayKey();
    const picked = randomPick(IMG.genkiRandom);
    state.choice = { date: key, ...picked };
    saveState(state);
    renderChoice();
  }

  /***************
   * eventsï¼ˆã‚¯ãƒªãƒƒã‚¯å£Šã‚Œã«ãã„å§”è­²ï¼‰
   ***************/
  document.addEventListener("click", (e)=>{
    const moodBtn = e.target.closest("[data-mood]");
    if (moodBtn){
      setMood(moodBtn.dataset.mood);
      return;
    }
  });

  doneBtn.addEventListener("click", saveDone);
  moreBtn.addEventListener("click", rerollGenki);

  navHome.addEventListener("click", ()=>setView("home"));
  navHistory.addEventListener("click", ()=>setView("history"));
  navHome2.addEventListener("click", ()=>setView("home"));
  navHistory2.addEventListener("click", ()=>setView("history"));

  clearBtn.addEventListener("click", ()=>{
    if (!confirm("å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
    state.history = [];
    saveState(state);
    renderHistory();
    renderTodayPreview();
  });

  /***************
   * init
   ***************/
  ensureChoice();
  updateStreakUI();
  setMood(state.mood);     // ã“ã‚ŒãŒ renderChoice ã‚‚å‘¼ã¶
  renderTodayPreview();
  setView("home");
</script>
</body>
</html>